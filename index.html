<script>
document.getElementById('fileSelect').addEventListener('change', function() {
    const fileName = this.value;
    if (!fileName) {
        document.getElementById('fileName').textContent = '';
        document.getElementById('tableContainer').innerHTML = '';
        return;
    }

    // Remove extension & make uppercase for display
    const displayName = fileName.replace(/\.[^/.]+$/, "").toUpperCase();

    fetch(fileName)
        .then(response => {
            if (!response.ok) throw new Error('File not found');

            // Get Last-Modified header if available
            const lastModified = response.headers.get('Last-Modified');
            let modifiedText = '';
            if (lastModified) {
                const dateObj = new Date(lastModified);
                modifiedText = ` | Last Modified: ${dateObj.toLocaleString()}`;
            }

            document.getElementById('fileName').textContent = 
                `File: ${displayName}${modifiedText}`;

            return response.json();
        })
        .then(jsonData => {
            if (!Array.isArray(jsonData)) {
                document.getElementById('tableContainer').innerHTML = 
                    '<p class="error">JSON file must contain an array of objects.</p>';
                return;
            }

            const columns = [...new Set(jsonData.flatMap(obj => Object.keys(obj)))];

            let tableHTML = '<table><thead><tr>';
            columns.forEach(col => {
                tableHTML += `<th>${col}</th>`;
            });
            tableHTML += '</tr></thead><tbody>';

            jsonData.forEach(item => {
                tableHTML += '<tr>';
                columns.forEach(col => {
                    tableHTML += `<td>${item[col] !== undefined ? item[col] : ''}</td>`;
                });
                tableHTML += '</tr>';
            });

            tableHTML += '</tbody></table>';
            document.getElementById('tableContainer').innerHTML = tableHTML;
        })
        .catch(err => {
            document.getElementById('tableContainer').innerHTML = 
                `<p class="error">Error: ${err.message}</p>`;
        });
});
</script>
